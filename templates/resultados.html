{% extends "base.html" %}
{% block title %}Resultados por Ente - SASP{% endblock %}

{% block content %}
<style>
  .report-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 1.5rem;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  }
  h2 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #004c6d;
  }
  .ente-bloque {
    margin-bottom: 2.5rem;
  }
  .ente-nombre {
    background: #004c6d;
    color: white;
    font-weight: 600;
    padding: 10px;
    border-radius: 6px 6px 0 0;
  }
  .tabla-resultados {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }
  .tabla-resultados th {
    background-color: #004c6d;
    color: white;
    padding: 10px;
    text-align: left;
  }
  .tabla-resultados td {
    border-bottom: 1px solid #e3e3e3;
    padding: 8px 10px;
  }
  .tabla-resultados tr:nth-child(even) {
    background-color: #f9f9f9;
  }
  .tabla-resultados tr:hover {
    background-color: #f0f8ff;
  }
  .link-rfc {
    color: #004c6d;
    text-decoration: none;
    font-weight: 600;
  }
  .link-rfc:hover {
    text-decoration: underline;
  }
  .estado-solventado {
    color: #0a7b33;
    font-weight: 600;
  }
  .estado-pendiente {
    color: #c62828;
    font-weight: 600;
  }
  .msg-vacio {
    text-align: center;
    color: #666;
    margin-top: 2rem;
  }
</style>

<div class="report-container">
  <h2>Resultados Agrupados por Ente</h2>

  {% if resultados %}
    {% for ente, lista in resultados.items() %}
    <div class="ente-bloque">
      <div class="ente-nombre">{{ ente }}</div>
      <table class="tabla-resultados">
        <thead>
          <tr>
            <th>RFC</th>
            <th>Nombre</th>
            <th>Puesto</th>
            <th>Entes Duplicados</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          {% for r in lista %}
          <tr>
            <td>
              {% if r.rfc %}
                <a href="{{ url_for('resultados_por_rfc', rfc=r.rfc) }}" class="link-rfc">{{ r.rfc }}</a>
              {% else %}
                Sin RFC
              {% endif %}
            </td>
            <td>{{ r.nombre or 'Sin nombre' }}</td>
            <td>
              {% set puesto = (r.registros[0].puesto if r.registros and r.registros[0].puesto else r.puesto) %}
              {{ puesto or 'Sin puesto' }}
            </td>
            <td>
              {% if r.entes %}
                {{ r.entes | join(', ') }}
              {% else %}
                Sin entes duplicados
              {% endif %}
            </td>
            <td>
              {% if r.estado == 'Solventado' %}
                <span class="estado-solventado">Solventado</span>
              {% else %}
                <span class="estado-pendiente">No Solventado</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endfor %}
  {% else %}
    <p class="msg-vacio">No hay resultados para mostrar.</p>
  {% endif %}
</div>
{% endblock %}

